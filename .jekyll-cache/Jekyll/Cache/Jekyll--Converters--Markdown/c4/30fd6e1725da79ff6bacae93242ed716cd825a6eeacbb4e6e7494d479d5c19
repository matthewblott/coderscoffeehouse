I"ˆ<<p>Anyone following my other blog posts will know I‚Äôm a .NET guy who works with Linux (we do exist) and so like a lot of *nix guys I work with a Mac. I love my Macbook but I still need to enter the Windows world from time to time and this is where I‚Äôve experienced a bit of pain. I use Parallels which I have to say is excellent and does about as good a job as can be expected to make switching between OSX and Windows as smooth as possible. However, trying to call SQL Server from my Mac and trying to use SSMS was where I had my biggest pain point. I‚Äôve documented what I did to make the experience much easier and hopefully this will help out others too.</p>

<h2 id="dark-theme">Dark Theme</h2>

<p>You can skip this step if you wish but the first thing I always do after installing SSMS is change the default theme to a darker theme. There‚Äôs some helpful info on how to do this <a href="http://blogs.sqlsentry.com/aaronbertrand/making-ssms-pretty-my-dark-theme/">here</a> but it can be a bit of a pain. Fortunately the same page has a dark theme you can download directly <a href="http://blogs.sqlsentry.com/wp-content/uploads/aaronbertrand/media/AB.DarkScheme.vssettings.zip">here</a> which you can then import by clicking the Tools link at the top of SSMS.</p>

<p><img src="/images/2016-05-23/2016-05-23@21.23.47-xs.jpg" alt="" /></p>

<p>This will then give you a theme the same as the one shown below which I find a lot easier on the eye.</p>

<p><img src="/images/2016-05-23/2016-05-23@21.20.45-xs.jpg" alt="" /></p>

<h2 id="allow-remote-connections">Allow Remote Connections</h2>

<p>This is something any seasoned developer who‚Äôs worked with SQL Server will have done at some point and you‚Äôll need to do the same again with your Windows virtual machine.</p>

<p>First enable TCP/IP in SQL Server Configuration Manager.</p>

<p><img src="/images/2016-04-18/2016-04-18@15.27.57-xs.jpg" alt="" /></p>

<p>Then right-click and select the properties, select the IP Addresses tab and enter 1433 in the TCP Port field under the IPAll section at the bottom.</p>

<p><img src="/images/2016-04-18/2016-04-18@15.28.07-xs.jpg" alt="" /></p>

<p>Finally for the remote connection add a rule to the Windows Firewall. Fire up the program then under Inbound Rules right-click and select New Rule then click next.</p>

<p><img src="/images/2016-04-18/2016-04-18@16.07.22-xs.jpg" alt="" /></p>

<p>Then enter the file location for the sqlserver.exe program in the ‚ÄúThis program path field‚Äù as shown below and then click Next.</p>

<p><img src="/images/2016-04-18/2016-04-18@16.08.06-xs.jpg" alt="" /></p>

<p>On the Action section click Next.</p>

<p><img src="/images/2016-04-18/2016-04-18@16.08.47-xs.jpg" alt="" /></p>

<p>On the Profile section only tick Private and click Next.</p>

<p><img src="/images/2016-04-18/2016-04-18@16.08.53-xs.jpg" alt="" /></p>

<p>Finally give your rule a name - MSSQL is as good a name as any - and then click Finish.</p>

<p><img src="/images/2016-04-18/2016-04-18@16.09.01-xs.jpg" alt="" /></p>

<p>Finally double-click your newly created rule then select the Protocols and Ports tab.</p>

<p><img src="/images/2016-04-18/2016-04-18@16.09.28-xs.jpg" alt="" /></p>

<p>Change the Local port from All Ports to 1433.</p>

<p><img src="/images/2016-04-18/2016-04-18@16.09.55-xs.jpg" alt="" /></p>

<p>Click OK. You will now be able to connect to SQL Server from your host OSX machine.</p>

<h2 id="password-file">Password File</h2>

<p>One really annoying thing with SSMS is its inability to retain passwords after you click the Remember Password checkbox.</p>

<p><img src="/images/2016-04-18/2016-04-18@15.28.32-xs.jpg" alt="" /></p>

<p>If you‚Äôre using SSMS many times throughout the day hunting for your passwords and then entering them soon hits your productivity level. Luckily there is a way round this. The trick is to save a copy of the password file then copy it before you fire up SSMS. First you need to create the file to copy so delete the existing file before we create a new file with the preferred login information.</p>

<p>C:\Users\Matt\AppData\Roaming\Microsoft\SQL Server Management Studio\12.0\SqlStudio.bin</p>

<p>Then fire up SSMS and connect to all the servers you want to be associated with password. One tip is to note the servers you connect to will appear in the reverse order. So the server you want to connect to most frequently you‚Äôll want to connect to last when creating the file. Once completed connecting to your servers make a copy of the file and save it as SqlStudio.bin.bak as shown below.</p>

<p><img src="/images/2016-05-23/2016-05-23@20.20.27-xs.jpg" alt="" /></p>

<p>Now you need to create a command file for starting SSMS that copies the SqlStudio.bin.bak file ready for SSMS to use. So create a text file called SSMS-Open.cmd and past the following commands then save the file.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="nb">cd</span> <span class="s2">"C:</span><span class="se">\U</span><span class="s2">sers</span><span class="se">\M</span><span class="s2">att</span><span class="se">\A</span><span class="s2">ppData</span><span class="se">\R</span><span class="s2">oaming</span><span class="se">\M</span><span class="s2">icrosoft</span><span class="se">\S</span><span class="s2">QL Server Management Studio</span><span class="se">\1</span><span class="s2">2.0"</span>
copy SqlStudio.bin.bak SqlStudio.bin /Y
start ssms.exe
</pre></td></tr></tbody></table></code></pre></figure>

<p>Now when you double-click on SSMS-Open.cmd SSMS should start using the SqlStudio.bin.bak file created in the previous step (if it doesn‚Äôt work you may need to open the file as an Administrator but we‚Äôre going to be coverting that in a minute anyhow).</p>

<h2 id="manifest-file">Manifest File</h2>

<p>Another serious pain with SSMS if you‚Äôre using a retina display is its rendering. It sucks big time and for some tasks it is quite literally unusable as shown below.</p>

<p><img src="/images/2016-05-23/2016-05-23@20.34.22-xs.jpg" alt="" /></p>

<p>Thankfully I found a super helpful way round this <a href="https://spaghettidba.com/2015/10/14/ssms-in-high-dpi-displays-how-to-stop-the-madness">here</a>. You need to create a manifest file in the same directory the application exe uses which forces your application to use Vista style bitmap scaling. The file format needs to be [application name].exe.manifest with [application name] being the name of your exe.</p>

<p>You have a couple of ways of going about this. You can just create a file Sssm.exe.manifest and leave it in the exe directory or you can copy a file on the fly and then delete it when the application is loaded in case you want to load SSMS using your retina display (which does look nicer even though you won‚Äôt be able to perform some tasks). I went with the latter as often I‚Äôm just using SSMS for querying and I prefer the retina rendering if possible.</p>

<p>In either case you‚Äôll need to create the following registry key.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre><span class="o">[</span>HKEY_LOCAL_MACHINE<span class="se">\S</span>OFTWARE<span class="se">\M</span>icrosoft<span class="se">\W</span>indows<span class="se">\C</span>urrentVersion<span class="se">\S</span>ideBySide]
<span class="s2">"PreferExternalManifest"</span><span class="o">=</span>dword:00000001
</pre></td></tr></tbody></table></code></pre></figure>

<p>Then create an app.exe.manifest file to copy. The location doesn‚Äôt matter. The contents of the file are below.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="nt">&lt;assembly</span> <span class="na">xmlns=</span><span class="s">"urn:schemas-microsoft-com:asm.v1"</span> <span class="na">manifestVersion=</span><span class="s">"1.0"</span> <span class="na">xmlns:asmv3=</span><span class="s">"urn:schemas-microsoft-com:asm.v3"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;dependentAssembly&gt;</span>
      <span class="nt">&lt;assemblyIdentity</span> <span class="na">type=</span><span class="s">"win32"</span> <span class="na">name=</span><span class="s">"Microsoft.Windows.Common-Controls"</span> <span class="na">version=</span><span class="s">"6.0.0.0"</span> <span class="na">processorArchitecture=</span><span class="s">"*"</span> <span class="na">publicKeyToken=</span><span class="s">"6595b64144ccf1df"</span> <span class="na">language=</span><span class="s">"*"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/dependentAssembly&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;dependentAssembly&gt;</span>
      <span class="nt">&lt;assemblyIdentity</span> <span class="na">type=</span><span class="s">"win32"</span> <span class="na">name=</span><span class="s">"Microsoft.VC90.CRT"</span> <span class="na">version=</span><span class="s">"9.0.21022.8"</span> <span class="na">processorArchitecture=</span><span class="s">"amd64"</span> <span class="na">publicKeyToken=</span><span class="s">"1fc8b3b9a1e18e3b"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/dependentAssembly&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;trustInfo</span> <span class="na">xmlns=</span><span class="s">"urn:schemas-microsoft-com:asm.v3"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;security&gt;</span>
      <span class="nt">&lt;requestedPrivileges&gt;</span>
        <span class="nt">&lt;requestedExecutionLevel</span> <span class="na">level=</span><span class="s">"asInvoker"</span> <span class="na">uiAccess=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/requestedPrivileges&gt;</span>
    <span class="nt">&lt;/security&gt;</span>
  <span class="nt">&lt;/trustInfo&gt;</span>
  <span class="nt">&lt;asmv3:application&gt;</span>
    <span class="nt">&lt;asmv3:windowsSettings</span> <span class="na">xmlns=</span><span class="s">"http://schemas.microsoft.com/SMI/2005/WindowsSettings"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ms_windowsSettings:dpiAware</span> <span class="na">xmlns:ms_windowsSettings=</span><span class="s">"http://schemas.microsoft.com/SMI/2005/WindowsSettings"</span><span class="nt">&gt;</span>false<span class="nt">&lt;/ms_windowsSettings:dpiAware&gt;</span>
    <span class="nt">&lt;/asmv3:windowsSettings&gt;</span>
  <span class="nt">&lt;/asmv3:application&gt;</span>
<span class="nt">&lt;/assembly&gt;</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Next create a text file called SSMS-Open-With-Manifest.cmd and copy paste the code below. Note the second line - this needs to point to the app.exe.manifest file you created in the previous step.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="nb">cd</span> <span class="s2">"C:</span><span class="se">\P</span><span class="s2">rogram Files (x86)</span><span class="se">\M</span><span class="s2">icrosoft SQL Server</span><span class="se">\1</span><span class="s2">20</span><span class="se">\T</span><span class="s2">ools</span><span class="se">\B</span><span class="s2">inn</span><span class="se">\M</span><span class="s2">anagementStudio"</span>
copy <span class="se">\\</span>Mac<span class="se">\H</span>ome<span class="se">\D</span>ev<span class="se">\s</span>cripts<span class="se">\w</span>indows<span class="se">\a</span>pp.exe.manifest Ssms.exe.manifest /Y
<span class="nb">cd</span> <span class="s2">"C:</span><span class="se">\U</span><span class="s2">sers</span><span class="se">\M</span><span class="s2">att</span><span class="se">\A</span><span class="s2">ppData</span><span class="se">\R</span><span class="s2">oaming</span><span class="se">\M</span><span class="s2">icrosoft</span><span class="se">\S</span><span class="s2">QL Server Management Studio</span><span class="se">\1</span><span class="s2">2.0"</span>
copy SqlStudio.bin.bak SqlStudio.bin /Y
start ssms.exe
<span class="nb">cd</span> <span class="s2">"C:</span><span class="se">\P</span><span class="s2">rogram Files (x86)</span><span class="se">\M</span><span class="s2">icrosoft SQL Server</span><span class="se">\1</span><span class="s2">20</span><span class="se">\T</span><span class="s2">ools</span><span class="se">\B</span><span class="s2">inn</span><span class="se">\M</span><span class="s2">anagementStudio"</span>
del Ssms.exe.manifest
</pre></td></tr></tbody></table></code></pre></figure>

<p>If you‚Äôve been following along you should have two files for opening SSMS. When you click on SSMS-Open.cmd it will open SSMS normally and when you click on SSMS-Open-With-Manifest.cmd it will open using Vista style rendering as shown below.</p>

<p><img src="/images/2016-04-18/2016-04-18@15.28.39-xs.jpg" alt="" /></p>

<p>Now if you try to create a new database you‚Äôll see something more user friendly unlike the screenshot in the first step of this section.</p>

<p><img src="/images/2016-05-23/2016-05-23@20.34.54-xs.jpg" alt="" /></p>

<h2 id="toolbar-shortcut">Toolbar Shortcut</h2>

<p>As stated earlier you may need to open the command files under Administrator but this can be done using a shortcut so you can just click and open. First from Windows create a shortcut on your shared desktop</p>

<p><img src="/images/2016-05-23/2016-05-23@20.22.19-xs.jpg" alt="" /></p>

<p>Make sure the Target and Start in fields are correctly filled out.</p>

<p><img src="/images/2016-05-21/2016-05-21@22.57.55-xs.jpg" alt="" /></p>

<p>Then click the Advanced button and make sure Run as administrator is ticked (this will fix any issues referred to earlier where the Windows command may complain copying the SqlStudio.bin.bak file).</p>

<p><img src="/images/2016-05-21/2016-05-21@22.59.59-xs.jpg" alt="" /></p>

<p>The default shortcut command is a bit ugly and it looks nicer to have the SSMS icon so to change that click the Change Icon button on the properties.</p>

<p><img src="/images/2016-05-21/2016-05-21@22.58.58-xs.jpg" alt="" /></p>

<p>Browse to the following file then click OK to set the icon.</p>

<p>C:\Program Files (x86)\Microsoft SQL Server\120\Tools\Binn\ManagementStudio\ssms.ico</p>

<p>Finally from OSX open Finder then browser to the newly created shortcut files and drag them to your toolbar.</p>

<p><img src="/images/2016-05-21/2016-05-21@23.00.27-xs.jpg" alt="" /></p>

<p>Now if you click on either file you can open SSMS directly with your saved passwords and rendering however you choose in Vista mode or using your retina settings.</p>

<p><img src="/images/2016-05-21/2016-05-21@23.00.52-xs.jpg" alt="" /></p>

<p>That‚Äôs it. I‚Äôve picked up these tips over the years and used them when I was still using Windows so I hope they‚Äôve been helpful. Please leave any comments below. Thanks :-)</p>
:ET